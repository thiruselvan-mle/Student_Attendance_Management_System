<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='student/dashboard.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>

    <!-- SIDEBAR -->
    <div class="sidebar">
        <h2 class="logo-name">Student Panel</h2>

        <a href="{{ url_for('student_dashboard') }}" class="active">Dashboard</a>
        <a href="{{ url_for('student_attendance_overview') }}">Attendance Overview</a>
        <a href="{{ url_for('subject_overview')}}">subject_overview</a>
        <a >Profile</a>
        <a >Settings</a>
        <a href="{{ url_for('logout') }}" class="logout">Logout</a>
    </div>


    <!-- MAIN CONTENT -->
    <div class="main">

        <div class="topbar">
            <h2>Welcome, {{ student_name }}</h2>
        </div>

        <!-- CARDS -->
        <div class="cards">

            <div class="card">
                <h3>Present %</h3>
                <canvas id="presentGauge"></canvas>
            </div>

            <div class="card">
                <h3>Absent %</h3>
                <canvas id="absentGauge"></canvas>
            </div>

            <!-- NEW TOTAL DAYS (NO CHART) -->
            <div class="card">
                <h3>Total Days</h3>
                <h1 class="total-days">{{ total_days }}</h1>
            </div>

        </div>

        <!-- TODAY STATUS -->
    <div class="today-box">
        <h3>Today Attendance Status</h3>

        {% if today_status == 'present' %}
            <p class="status present">✔ Present</p>
        {% else %}
            <p class="status absent">✘ Absent</p>
        {% endif %}
    </div>


    </div>

    <!-- center text plugin -->
    <script>
        const centerTextPlugin = {
            id: 'centerText',
            afterDraw(chart, args, options) {
                const {ctx, chartArea: {width, height}} = chart;
                ctx.save();
                ctx.font = "bold 20px Arial";
                ctx.fillStyle = options.color || "black";
                ctx.textAlign = "center";
                ctx.textBaseline = "middle";
                ctx.fillText(options.text, width / 2, height / 2);
            }
        };
    </script>

    <script>
        function gaugeChart(id, value, color) {
            new Chart(document.getElementById(id), {
                type: "doughnut",
                plugins: [centerTextPlugin],
                data: {
                    labels: ["Value", ""],
                    datasets: [{
                        data: [value, 100 - value],
                        backgroundColor: [color, "#ddd"],
                        borderWidth: 0
                    }]
                },
                options: {
                    cutout: "75%",
                    plugins: { 
                        legend: { display: false },
                        centerText: { text: value + "%", color: color }
                    }
                }
            });
        }

        gaugeChart("presentGauge", {{ present_percent }}, "#28a745");
        gaugeChart("absentGauge", {{ absent_percent }}, "#dc3545");
    </script>

</body>
</html>
