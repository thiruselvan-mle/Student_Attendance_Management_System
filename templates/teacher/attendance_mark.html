<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Attendance Mark</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="{{ url_for('static', filename='teacher/attendance_mark.css') }}">
</head>
<body>

<div class="page">

    <!-- HEADER -->
    <div class="header">
        <a href="{{ back_url }}" class="back">← Back</a>

        <div class="info">
            <h2>Department: {{department}} - {{year}} Year</h2>
            <p>Subject: {{subject_name}} | Period: {{period}} | Today: {{ today_date }}</p>
        </div>
    </div>

    <div class="card">

        <div class="table-head">
            <span>S.No</span>
            <span>Register No</span>
            <span>Name</span>
            <span>Status</span>
        </div>

        <form method="POST" action="{{ url_for('teacher.attendance_submit') }}">
            <input type="hidden" name="back_url" value="{{ back_url }}">
            <input type="hidden" name="period_no" value="{{ period }}">
            <input type="hidden" name="attendance_date" value="{{ today_date }}">
            <input type="hidden" name="subject_code" value="{{ subject_code }}">
            <input type="hidden" name="subject_name" value="{{ subject_name }}">
            <input type="hidden" name="teacher_id" value="{{ teacher_id }}">
            <input type="hidden" name="department" value="{{ department }}">
            <input type="hidden" name="semester" value="{{ semester }}">

            {% for student in class_list %}
                <div class="row">
                    <span>{{ loop.index }}</span>
                    <span>{{ student.register_no }}</span>
                    <span>{{ student.name }}</span>

                    <input type="hidden" name="status_{{ student.register_no }}" id="status_{{ student.register_no }}" value="Present">
                    <input type="hidden" name="name_{{ student.register_no }}" value = "{{ student.name }}">
                    <button type="button" class="status-btn present" onclick="toggleStatus(this,'{{ student.register_no }}')">✔</button>
                </div>
            {% endfor %}
            
            
                <div class="btn-group">
                    {% if mark_btn %}
                        <button type="submit" name ="action" value="submit" class="submit-btn">Submit Attendance</button>
                    {% endif %}
                    {% if edit_btn %}
                        <button type="submit" name ="action" value="edit" name="edit" class="edit-btn">Edit Attendance</button>
                    {% endif %}
                </div>
        </form>
    </div>
</div>

    <script>
        function toggleStatus(btn, regNo) {

            const hiddenInput = document.getElementById("status_" + regNo);

            if (btn.classList.contains("present")) {
                btn.classList.remove("present");
                btn.classList.add("absent");
                btn.innerText = "✖";
                hiddenInput.value = "Absent";
            } 
            else {
                btn.classList.remove("absent");
                btn.classList.add("present");
                btn.innerText = "✔";
                hiddenInput.value = "Present";
            }
        }

    </script>

</body>
</html>
